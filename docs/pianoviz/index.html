<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="0x00000000.dev">





<title>The making of PianoViz; An augmented Reality Piano Assistant | 0x00000000 Blog</title>



    <link rel="icon" href="/favicon.ico">



<link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
<link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
<link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 5.1.1"><style>
.dark-color-main {
    background-color: #121212;
}
</style><style>.no-js img.lazyload {
    display: none;
}img[data-sizes="auto"] {
    display: block;
    width: 100%;
}</style></head>

<body class="dark-color-main text-light">
    <br><br><br><br>
    <div class="wrapper">
        <header>
    <style>
        .navbar {
            /* position: fixed; */
            top: 0;
            width: 100%;
            height: 6%;
            padding-top: 0px;
            padding-bottom: 0px;
            background: #5755d9;
            z-index: 5;
            position: absolute;
        }

        @media screen and (min-width: 170px) {
            .navbar {
                display: flex;
            }

            .main {
                padding-top: 0pt;
            }
        }
    </style>
    <!-- NAV -->
    <header class="navbar">
        <section class="navbar-section">
            <!-- <div class="navbar-header header-logo"><a href="/">0x00000000 Blog</a></div> -->
        </section>
        <section class="navbar-center">
            <a class="btn btn-link text-light" href="/">Home</a>
            
                <a class="btn btn-link text-light" href="/archives">
                    Posts
                </a>
                
                <a class="btn btn-link text-light" href="/tags">
                    Tags
                </a>
                
        </section>
        <section class="navbar-section">
            <!-- <input id="switch_default" type="checkbox" class="switch_default"> -->
            <!-- <label for="switch_default" class="toggleBtn"></label> -->
        </section>
    </header>
</header>
<br><br>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.classList.contains("active")) {
            toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        } else {
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
        <article class="post-wrap columns">
            <style>
                .div-only-mobile {
                    display: none;
                }

                .div-no-mobile {
                    display: block;
                }

                @media screen and (max-width: 1280px) {
                    .div-no-mobile {
                        display: none
                    }

                    .div-only-mobile {
                        display: block;
                    }
                }

                ul {
                    list-style-position: outside;
                }

                ol ol, ol ul, ul ol, ul ul {
                    margin: 0 0 0 0;
                }

                .text-light {
                    color: #e8e8e8!important;
                }

            </style>
            <div class="column col-xl-2"></div>
            <div class="column col-8 col-xl-12">
                <header class="post-header">
                    <h1 class="post-title">
                        The making of PianoViz; An augmented Reality Piano Assistant
                    </h1>
                    
                        <div class="post-meta">
                            
                                <a class="text-light">Author: </a><a class="text-gray">
                                        Jordan Hoffmann
                                    </a>
                                
                                    <br>
                                    
                                        <a class="text-light">Date: </a><a class="text-gray">
                                                February 21, 2022
                                            </a>
                                        
                                <br>
                                <a class="text-light">Views: <script>document.write('<img src="//counter.websiteout.net/compte.php?S='+encodeURI(window.location.href)+'&C=9&D=0&N=0&M=0" alt="" border="0"/>');</script></a>
                        </div>
                        
                </header>
                <div class="post-content">
                    <h2 id="Design-Goal"><a href="#Design-Goal" class="headerlink" title="Design Goal"></a>Design Goal</h2><p>When starting this project, the primary design goal was to create a gamified teaching experience where players would learn to play piano on a bluetooth MIDI keyboard while seeing note blocks falling onto their keyboard keys in time with the song they’re playing. If done right, the experience should be reminiscent of <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Guitar_Hero">Guitar Hero</a> or <a target="_blank" rel="noopener" href="https://synthesiagame.com/">Synthesia</a> with the exception being that the user is seeing the notes flying towards an actual piano as opposed to a digital copy of one on a monitor.</p>
<h2 id="Objectives"><a href="#Objectives" class="headerlink" title="Objectives"></a>Objectives</h2><p>In order to accomplish our design goal, we needed to achieve the following objectives:</p>
<ul>
<li>Find XR hardware that is either:<ol>
<li>A VR setup capable of rendering a game world with an accurate, real time, 1-1 correspondence with important elements of the real world such as hand location, finger location, and piano location</li>
<li>An AR setup capable of rendering the MIDI notes on top of the physical world and aligning it with the physical piano</li>
</ol>
</li>
<li>create the ‘note falling’ MIDI visualization in a 3d environment on time with the music being played</li>
<li>lock the ‘game world’ to the ‘real world’ geometry, therefore augmenting the boundary between the physical play-space and the artificial MIDI visualization</li>
</ul>
<h2 id="Objective-1-Finding-hardware"><a href="#Objective-1-Finding-hardware" class="headerlink" title="[Objective 1] Finding hardware"></a>[Objective 1] Finding hardware</h2><h3 id="Attempt-1-VR"><a href="#Attempt-1-VR" class="headerlink" title="Attempt 1: VR"></a>Attempt 1: VR</h3><p>our first attempt at finding hardware to accomplish our design goals, was to investigate the use of a traditional VR headset, such as the <a target="_blank" rel="noopener" href="https://store.steampowered.com/valveindex">Valve Index</a>, in combination with a <a target="_blank" rel="noopener" href="https://www.ultraleap.com/product/leap-motion-controller/">Leap Motion Hand Tracking</a> Device. While this was knowingly going to be the harder option, it would’ve accomplished an additional unspoken goal of proving that augmented reality can by “faked” using much cheaper VR hardware. Unfortunately we didn’t reach that conclusion. As it turns out, while the Valve Index has very good tracking, The Leap Motion Controller is just not ready for tracking the precise and delicate hand movements of playing a piano. We quickly learned that the players hands would be rendered so inaccurately that the game would be unplayable.</p>
<p>We did consider the potential of making up for this inaccuracy by employing the use of inverse kinematics. This of course would only be possible however if we had more data. we had a physical MIDI keyboard, which was a great start because that way we could know whether a key is being pressed, but that wouldn’t provide any info regarding which finger is pressing it, or any data on whether they’re just resting their finger’s on the keys. as a result, we concluded that this method would require a ton of custom hardware, a rewrite of the leap motion library, and all around tons of work for a subpar product.</p>
<p>If you are however looking to use Leap Motion tracking for your own project, don’t let me deter you all together. the Leap Motion Controller is great at tracking the location of your hand in general, and can pick up gestures such as pointing and fists. it just struggles with the more precise finger movement that playing instruments requires.</p>
<h3 id="Attempt-2-Hololens-Augmented-Reality"><a href="#Attempt-2-Hololens-Augmented-Reality" class="headerlink" title="Attempt 2: Hololens Augmented Reality"></a>Attempt 2: Hololens Augmented Reality</h3><p>Luckily, we had access to the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/hololens/hololens1-hardware">Hololens 1</a>, so all was not lost. With the disadvantage of being significantly more expensive, The hololens is really the only commercially available hardware built for the exact problem we’re attempting to solve. The biggest difference was that because the game world is rendered on glass, the user can still see their physical environment. This means they can see their hands and the keyboard - both without any work on our part. We no longer needed to replicate anything in the physical world space because it was already visible. This just goes to show that using the correct tool for the job really saves hours of work and headache.</p>
<h2 id="Objective-2-MIDI-Visualization"><a href="#Objective-2-MIDI-Visualization" class="headerlink" title="[Objective 2] MIDI Visualization"></a>[Objective 2] MIDI Visualization</h2><p>One challenge we needed to overcome however was creating an engaging, familiar, and helpful MIDI Visualization to aid the player in anticipating upcoming notes. </p>
<div style="position:relative; padding-bottom:calc(56.25% + 44px)"><iframe src="https://gfycat.com/ifr/BruisedEssentialEider" frameborder="0" scrolling="no" width="100%" height="100%" style="position:absolute;top:0;left:0;" allowfullscreen=""></iframe></div>

<h3 id="Non-Linear-Tweening"><a href="#Non-Linear-Tweening" class="headerlink" title="Non-Linear Tweening"></a>Non-Linear Tweening</h3><p>As you can see in the above video, one big difference between this solution and other rhythm games, is that the notes tween at an exponential rate rather than simply sliding across the screen in linear time. To do this, I made heavy use of a Unity library titled <a target="_blank" rel="noopener" href="http://dotween.demigiant.com/">DoTween</a>. While the library helped a ton, an interesting problem I had to solve was how to scale the notes in such a way that if you were to put a horizontal line at any part of the screen, the note would take the exact same amount of time to cross the line. If the note were always the same scale, it would appear as a longer duration note while moving slowly and a shorter duration note while moving quickly. Unironically, this was a warping of a virtual spacetime.</p>
<p>Conveniently however, the notes are axis aligned, non textured, rectangular prisms, so we can take a shortcut. If the mesh were more complicated, I’d need to tween each vertex separately in the vertex shader so that it looks correct. Instead, I was able to fake it by tweening the front and the back of the prism separately with the following tween sequence</p>
<figure class="highlight cs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> backY; <span class="comment">// y of the object's transform that's furthest from destination</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> frontY; <span class="comment">// y of the object's transform that's closest to destination</span></span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>Tweens the notes scale and position accross the play space</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Also stores the NoteTweenScript as the tween's target so it can be used for filtered operations<span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="endPos"&gt;</span>The position you wish the beginning of the note to cross in world space<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="duration"&gt;</span>The duration of the tween<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="backDelay"&gt;</span>how long to delay movement of the back of the bar<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Sequence <span class="title">DOMoveScale</span>(<span class="params">Vector3 endPos, <span class="keyword">float</span> duration, <span class="keyword">float</span> backDelay, Ease ease</span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    Vector3 endLocal = transform.InverseTransformPoint(endPos);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// make sure that desination only needs to move in the local y direction</span></span><br><span class="line">    Assert.IsTrue(Mathf.Abs(<span class="number">0.0f</span> - endLocal.x) &lt; <span class="number">0.001</span>);</span><br><span class="line">    Assert.IsTrue(Mathf.Abs(<span class="number">0.0f</span> - endLocal.z) &lt; <span class="number">0.001</span>);</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">float</span> endY = endLocal.y;</span><br><span class="line">    <span class="keyword">return</span> DOTween.Sequence()</span><br><span class="line">        .Insert(<span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// tween the front of the object</span></span><br><span class="line">            DOTween.Sequence()</span><br><span class="line">                .Append(DOTween.To(() =&gt; frontY, x =&gt; frontY = x, endY,</span><br><span class="line">                    duration).SetEase(ease))</span><br><span class="line">        )</span><br><span class="line">        .Insert(<span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// delay for backDelay then tween the back of the object</span></span><br><span class="line">            DOTween.Sequence()</span><br><span class="line">                .AppendInterval(backDelay)</span><br><span class="line">                .Append(DOTween.To(() =&gt; backY, x =&gt; backY = x, endY,</span><br><span class="line">                    duration).SetEase(ease))</span><br><span class="line">        )</span><br><span class="line">        .SetTarget(<span class="keyword">this</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update is called once per frame</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    Vector3 localPosition = transform.localPosition;</span><br><span class="line">    Vector3 scale = transform.localScale;</span><br><span class="line">    localPosition.y = frontY;</span><br><span class="line">    scale.y = backY - frontY;</span><br><span class="line"></span><br><span class="line">    transform.localPosition = localPosition;</span><br><span class="line">    transform.localScale = scale;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Let-There-be-Music"><a href="#Let-There-be-Music" class="headerlink" title="Let There be Music"></a>Let There be Music</h3><p>The other important element of this task, was of course spawning the notes in tandem with the music. To play, MIDI files, I used the library <a target="_blank" rel="noopener" href="https://paxstellar.fr/">MPTK</a>. Unlike playing a WAV file, MIDI, and the MPTK library respectively, provides the programmer with crucial info about when each note will be played in the song and for how long. To assist in the process, MPTK includes a MidiFilePlayer which parses the file just as it normally would, but instead of immediately playing music, it instead calls a user provided callback function. The advantage here was that I was able to spawn the note at the top of the play-space at this mark, and instead wait until the note has tweened to the keyboard before playing the note. There’s a <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=A7jB-UchkdY&amp;ab_channel=ThierryBachmann">great sample project in the MPTK library</a> which helped get me started.</p>
<h3 id="Sheering-the-visualization-to-utilize-a-larger-play-space"><a href="#Sheering-the-visualization-to-utilize-a-larger-play-space" class="headerlink" title="Sheering the visualization to utilize a larger play-space"></a>Sheering the visualization to utilize a larger play-space</h3><p>TODO: I have a “working” solution for this but I may end up changing it so that it integrates better with our recording setup. I’ll finish this section when I know for sure…</p>
<h2 id="Objective-3-World-Locking-with-MRTK-and-arUco-markers"><a href="#Objective-3-World-Locking-with-MRTK-and-arUco-markers" class="headerlink" title="[Objective 3] World Locking with MRTK and arUco markers"></a>[Objective 3] World Locking with MRTK and arUco markers</h2><p><a target="_blank" rel="noopener" href="https://microsoft.github.io/MixedReality-SpectatorView/README.html">Spectator View</a><br>TODO: we haven’t fully finished this process. I’ll write this section once we have</p>

                </div>
                
                        <section class="post-tags">
                            <div>
                                <span>Tag(s):</span>
                                <span class="tag">
                                    
                                        
                                            <a href="/tags/Augmented-Reality-AR/"># Augmented Reality (AR)</a>
                                            
                                            <a href="/tags/Hardware/"># Hardware</a>
                                            
                                            <a href="/tags/MIDI/"># MIDI</a>
                                            
                                            <a href="/tags/Bluetooth/"># Bluetooth</a>
                                            
                                            <a href="/tags/Mixed-Reality-Toolkit-MRTK/"># Mixed Reality Toolkit (MRTK)</a>
                                            
                                                
                                </span>
                            </div>
                            <div>
                                <a href="javascript:window.history.back();">back</a>
                                <span>· </span>
                                <a href="/">home</a>
                            </div>
                        </section>
                        <section class="post-nav">
                            
                                    
                                        <a class="next" rel="next" href="/vulkan-retrospective/">
                                            Retrospective on Vulkan in DeltaBlade 2700
                                        </a>
                                        
                        </section>
            </div>
            <div class="column col-xl-2">
                
                    
                        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
                            
            </div>
        </article>
</div>
        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
<!-- © 0x00000000.dev |  -->
        <span>Powered by <a href="https://hexo.io" target="_blank">Hexo</a></span>
    </div>
</footer>

    </div>


</body><script>!function(e,t){var r=function(){t(e.lazySizes),e.removeEventListener("lazyunveilread",r,!0)};t=t.bind(null,e,e.document),"object"==typeof module&&module.exports?t(require("lazysizes")):e.lazySizes?r():e.addEventListener("lazyunveilread",r,!0)}(window,function(u,a,d){"use strict";var i,n,s,l,t,r,p,o,c,f,m,y=d&&d.cfg,e=a.createElement("img"),g="sizes"in e&&"srcset"in e,h=/\s+\d+h/g,e=(n=/\s+(\d+)(w|h)\s+(\d+)(w|h)/,s=Array.prototype.forEach,function(){function r(e){var t,r=e.getAttribute(lazySizesConfig.srcsetAttr);r&&(t=r.match(n))&&((t="w"==t[2]?t[1]/t[3]:t[3]/t[1])&&e.setAttribute("data-aspectratio",t),e.setAttribute(lazySizesConfig.srcsetAttr,r.replace(h,"")))}function e(e){var t;e.detail.instance==d&&((t=e.target.parentNode)&&"PICTURE"==t.nodeName&&s.call(t.getElementsByTagName("source"),r),r(e.target))}function t(){i.currentSrc&&a.removeEventListener("lazybeforeunveil",e)}var i=a.createElement("img");a.addEventListener("lazybeforeunveil",e),i.onload=t,i.onerror=t,i.srcset="data:,a 1w 1h",i.complete&&t()});function z(e,t){return e.w-t.w}function v(e,t,r,i){l.push({c:t,u:r,w:+i})}function b(e,t){var r,i=e.getAttribute("srcset")||e.getAttribute(y.srcsetAttr);!i&&t&&(i=e._lazypolyfill?e._lazypolyfill._set:e.getAttribute(y.srcAttr)||e.getAttribute("src")),e._lazypolyfill&&e._lazypolyfill._set==i||(r=o(i||""),t&&e.parentNode&&(r.isPicture="PICTURE"==e.parentNode.nodeName.toUpperCase(),r.isPicture&&u.matchMedia&&(d.aC(e,"lazymatchmedia"),c())),r._set=i,Object.defineProperty(e,"_lazypolyfill",{value:r,writable:!0}))}function w(e){var t,r,i,a,n,s,l,o,c=e;if(b(c,!0),(a=c._lazypolyfill).isPicture)for(r=0,i=(t=e.parentNode.getElementsByTagName("source")).length;r<i;r++)if(y.supportsType(t[r].getAttribute("type"),e)&&f(t[r].getAttribute("media"))){c=t[r],b(c),a=c._lazypolyfill;break}return 1<a.length?(s=c.getAttribute("sizes")||"",s=p.test(s)&&parseInt(s,10)||d.gW(e,e.parentNode),a.d=(l=e,o=u.devicePixelRatio||1,l=d.getX&&d.getX(l),Math.min(l||o,2.5,o)),!a.src||!a.w||a.w<s?(a.w=s,n=function(e){for(var t,r,i=e.length,a=e[i-1],n=0;n<i;n++)if((a=e[n]).d=a.w/e.w,a.d>=e.d){!a.cached&&(t=e[n-1])&&t.d>e.d-.13*Math.pow(e.d,2.2)&&(r=Math.pow(t.d-.6,1.6),t.cached&&(t.d+=.15*r),t.d+(a.d-e.d)*r>e.d&&(a=t));break}return a}(a.sort(z)),a.src=n):n=a.src):n=a[0],n}function A(e){var t;g&&e.parentNode&&"PICTURE"!=e.parentNode.nodeName.toUpperCase()||(t=w(e))&&t.u&&e._lazypolyfill.cur!=t.u&&(e._lazypolyfill.cur=t.u,t.cached=!0,e.setAttribute(y.srcAttr,t.u),e.setAttribute("src",t.u))}y.supportsType||(y.supportsType=function(e){return!e}),u.HTMLPictureElement&&g?!d.hasHDescriptorFix&&a.msElementsFromPoint&&(d.hasHDescriptorFix=!0,e()):u.picturefill||y.pf||(y.pf=function(e){var t,r;if(!u.picturefill)for(t=0,r=e.elements.length;t<r;t++)i(e.elements[t])},p=/^\s*\d+\.*\d*px\s*$/,t=/(([^,\s].[^\s]+)\s+(\d+)w)/g,r=/\s/,c=function(){var e,r;function t(){for(var e=0,t=r.length;e<t;e++)i(r[e])}c.init||(c.init=!0,addEventListener("resize",(r=a.getElementsByClassName("lazymatchmedia"),function(){clearTimeout(e),e=setTimeout(t,66)})))},f=function(e){return u.matchMedia?(f=function(e){return!e||(matchMedia(e)||{}).matches})(e):!e},A.parse=o=function(e){return l=[],(e=e.trim()).replace(h,"").replace(t,v),l.length||!e||r.test(e)||l.push({c:e,u:e,w:99}),l},i=A,y.loadedClass&&y.loadingClass&&(m=[],['img[sizes$="px"][srcset].',"picture > img:not([srcset])."].forEach(function(e){m.push(e+y.loadedClass),m.push(e+y.loadingClass)}),y.pf({elements:a.querySelectorAll(m.join(", "))})))});</script><script>!function(e,t){t=t(e,e.document);e.lazySizes=t,"object"==typeof module&&module.exports&&(module.exports=t)}(window,function(a,m){"use strict";if(m.getElementsByClassName){var z,n,i,t,s,o,y=m.documentElement,r=a.Date,l=a.HTMLPictureElement,c="addEventListener",h="getAttribute",d=a[c],u=a.setTimeout,f=a.requestAnimationFrame||u,v=a.requestIdleCallback,g=/^picture$/i,p=["load","error","lazyincluded","_lazyloaded"],C={},b=Array.prototype.forEach,A=function(e,t){return C[t]||(C[t]=new RegExp("(\\s|^)"+t+"(\\s|$)")),C[t].test(e[h]("class")||"")&&C[t]},E=function(e,t){A(e,t)||e.setAttribute("class",(e[h]("class")||"").trim()+" "+t)},_=function(e,t){(t=A(e,t))&&e.setAttribute("class",(e[h]("class")||"").replace(t," "))},w=function(t,n,e){var a=e?c:"removeEventListener";e&&w(t,n),p.forEach(function(e){t[a](e,n)})},M=function(e,t,n,a,i){var s=m.createEvent("Event");return(n=n||{}).instance=ue,s.initEvent(t,!a,!i),s.detail=n,e.dispatchEvent(s),s},N=function(e,t){var n;!l&&(n=a.picturefill||z.pf)?(t&&t.src&&!e[h]("srcset")&&e.setAttribute("srcset",t.src),n({reevaluate:!0,elements:[e]})):t&&t.src&&(e.src=t.src)},x=function(e,t){return(getComputedStyle(e,null)||{})[t]},W=function(e,t,n){for(n=n||e.offsetWidth;n<z.minSize&&t&&!e._lazysizesWidth;)n=t.offsetWidth,t=t.parentNode;return n},T=(s=[],o=t=[],he._lsFlush=ye,he),e=function(n,e){return e?function(){T(n)}:function(){var e=this,t=arguments;T(function(){n.apply(e,t)})}},B=function(e){var t,n,a=function(){t=null,e()},i=function(){var e=r.now()-n;e<99?u(i,99-e):(v||a)(a)};return function(){n=r.now(),t=t||u(i,99)}};!function(){var e,t={lazyClass:"lazyload",loadedClass:"lazyloaded",loadingClass:"lazyloading",preloadClass:"lazypreload",errorClass:"lazyerror",autosizesClass:"lazyautosizes",srcAttr:"data-src",srcsetAttr:"data-srcset",sizesAttr:"data-sizes",minSize:40,customMedia:{},init:!0,expFactor:1.5,hFac:.8,loadMode:2,loadHidden:!0,ricTimeout:0,throttleDelay:125};for(e in z=a.lazySizesConfig||a.lazysizesConfig||{},t)e in z||(z[e]=t[e]);a.lazySizesConfig=z,u(function(){z.init&&ze()})}();var F,S,L,R,k,D,H,O,P,$,I,q,j,G,J,K,Q,U,V,X,Y,Z,ee,te,ne,ae,ie,se,oe,re,le,ce,de,ue,fe=(V=/^img$/i,X=/^iframe$/i,Y="onscroll"in a&&!/(gle|ing)bot/.test(navigator.userAgent),te=-1,j=pe,J=ee=Z=0,K=z.throttleDelay,Q=z.ricTimeout,U=v&&49<Q?function(){v(Ce,{timeout:Q}),Q!==z.ricTimeout&&(Q=z.ricTimeout)}:e(function(){u(Ce)},!0),ae=e(be),ie=function(e){ae({target:e.target})},se=e(function(t,e,n,a,i){var s,o,r,l;(r=M(t,"lazybeforeunveil",e)).defaultPrevented||(a&&(n?E(t,z.autosizesClass):t.setAttribute("sizes",a)),n=t[h](z.srcsetAttr),a=t[h](z.srcAttr),i&&(o=(s=t.parentNode)&&g.test(s.nodeName||"")),l=e.firesLoad||"src"in t&&(n||a||o),r={target:t},E(t,z.loadingClass),l&&(clearTimeout(L),L=u(ve,2500),w(t,ie,!0)),o&&b.call(s.getElementsByTagName("source"),Ae),n?t.setAttribute("srcset",n):a&&!o&&(X.test(t.nodeName)?function(t,n){try{t.contentWindow.location.replace(n)}catch(e){t.src=n}}(t,a):t.src=a),i&&(n||o)&&N(t,{src:a})),t._lazyRace&&delete t._lazyRace,_(t,z.lazyClass),T(function(){var e=t.complete&&1<t.naturalWidth;l&&!e||(e&&E(t,"ls-is-cached"),be(r),t._lazyCache=!0,u(function(){"_lazyCache"in t&&delete t._lazyCache},9))},!0)}),re=function(){var e;S||(r.now()-k<999?u(re,999):(e=B(function(){z.loadMode=3,ne()}),S=!0,z.loadMode=3,ne(),d("scroll",function(){3==z.loadMode&&(z.loadMode=2),e()},!0)))},{_:function(){k=r.now(),ue.elements=m.getElementsByClassName(z.lazyClass),F=m.getElementsByClassName(z.lazyClass+" "+z.preloadClass),d("scroll",ne,!0),d("resize",ne,!0),a.MutationObserver?new MutationObserver(ne).observe(y,{childList:!0,subtree:!0,attributes:!0}):(y[c]("DOMNodeInserted",ne,!0),y[c]("DOMAttrModified",ne,!0),setInterval(ne,999)),d("hashchange",ne,!0),["focus","mouseover","click","load","transitionend","animationend","webkitAnimationEnd"].forEach(function(e){m[c](e,ne,!0)}),/d$|^c/.test(m.readyState)?re():(d("load",re),m[c]("DOMContentLoaded",ne),u(re,2e4)),ue.elements.length?(pe(),T._lsFlush()):ne()},checkElems:ne=function(e){var t;(e=!0===e)&&(Q=33),G||(G=!0,(t=K-(r.now()-J))<0&&(t=0),e||t<9?U():u(U,t))},unveil:oe=function(e){var t,n=V.test(e.nodeName),a=n&&(e[h](z.sizesAttr)||e[h]("sizes")),i="auto"==a;(!i&&S||!n||!e[h]("src")&&!e.srcset||e.complete||A(e,z.errorClass)||!A(e,z.lazyClass))&&(t=M(e,"lazyunveilread").detail,i&&me.updateElem(e,!0,e.offsetWidth),e._lazyRace=!0,ee++,se(e,t,i,a,n))}}),me=(ce=e(function(e,t,n,a){var i,s,o;if(e._lazysizesWidth=a,e.setAttribute("sizes",a+="px"),g.test(t.nodeName||""))for(s=0,o=(i=t.getElementsByTagName("source")).length;s<o;s++)i[s].setAttribute("sizes",a);n.detail.dataAttr||N(e,n.detail)}),{_:function(){le=m.getElementsByClassName(z.autosizesClass),d("resize",de)},checkElems:de=B(function(){var e,t=le.length;if(t)for(e=0;e<t;e++)Ee(le[e])}),updateElem:Ee}),ze=function(){ze.i||(ze.i=!0,me._(),fe._())};return ue={cfg:z,autoSizer:me,loader:fe,init:ze,uP:N,aC:E,rC:_,hC:A,fire:M,gW:W,rAF:T}}function ye(){var e=o;for(o=t.length?s:t,i=!(n=!0);e.length;)e.shift()();n=!1}function he(e,t){n&&!t?e.apply(this,arguments):(o.push(e),i||(i=!0,(m.hidden?u:f)(ye)))}function ve(e){ee--,e&&!(ee<0)&&e.target||(ee=0)}function ge(e){return(q=null==q?"hidden"==x(m.body,"visibility"):q)||"hidden"!=x(e.parentNode,"visibility")&&"hidden"!=x(e,"visibility")}function pe(){var e,t,n,a,i,s,o,r,l,c,d,u,f=ue.elements;if((R=z.loadMode)&&ee<8&&(e=f.length)){for(t=0,te++,c=!z.expand||z.expand<1?500<y.clientHeight&&500<y.clientWidth?500:370:z.expand,d=(ue._defEx=c)*z.expFactor,u=z.hFac,q=null,Z<d&&ee<1&&2<te&&2<R&&!m.hidden?(Z=d,te=0):Z=1<R&&1<te&&ee<6?c:0;t<e;t++)if(f[t]&&!f[t]._lazyRace)if(Y)if(l!==(s=!(r=f[t][h]("data-expand"))||!(s=+r)?Z:s)&&(D=innerWidth+s*u,H=innerHeight+s,o=-1*s,l=s),n=f[t].getBoundingClientRect(),(I=n.bottom)>=o&&(O=n.top)<=H&&($=n.right)>=o*u&&(P=n.left)<=D&&(I||$||P||O)&&(z.loadHidden||ge(f[t]))&&(S&&ee<3&&!r&&(R<3||te<4)||function(e,t){var n,a=e,i=ge(e);for(O-=t,I+=t,P-=t,$+=t;i&&(a=a.offsetParent)&&a!=m.body&&a!=y;)(i=0<(x(a,"opacity")||1))&&"visible"!=x(a,"overflow")&&(n=a.getBoundingClientRect(),i=$>n.left&&P<n.right&&I>n.top-1&&O<n.bottom+1);return i}(f[t],s))){if(oe(f[t]),i=!0,9<ee)break}else!i&&S&&!a&&ee<4&&te<4&&2<R&&(F[0]||z.preloadAfterLoad)&&(F[0]||!r&&(I||$||P||O||"auto"!=f[t][h](z.sizesAttr)))&&(a=F[0]||f[t]);else oe(f[t]);a&&!i&&oe(a)}}function Ce(){G=!1,J=r.now(),j()}function be(e){var t=e.target;t._lazyCache?delete t._lazyCache:(ve(e),E(t,z.loadedClass),_(t,z.loadingClass),w(t,ie),M(t,"lazyloaded"))}function Ae(e){var t,n=e[h](z.srcsetAttr);(t=z.customMedia[e[h]("data-media")||e[h]("media")])&&e.setAttribute("media",t),n&&e.setAttribute("srcset",n)}function Ee(e,t,n){var a=e.parentNode;a&&(n=W(e,a,n),(t=M(e,"lazybeforesizes",{width:n,dataAttr:!!t})).defaultPrevented||(n=t.detail.width)&&n!==e._lazysizesWidth&&ce(e,a,t,n))}});lazySizes.init();</script></html>